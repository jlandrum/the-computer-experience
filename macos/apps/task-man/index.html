<template>
  <app-task-man>
    <menu-segment segment-id="finder">
      <menu-item title="File">
        <menu-dropdown>
          <menu-dropdown-item label="Exit" action="close"></menu-dropdown-item>
        </menu-dropdown>
      </menu-item>    
    </menu-segment>
    <mac-window width="200" height="auto" x="590" y="0" always-on-bottom>
      <mac-window-chrome>
        <span>TaskMan</span>
      </mac-window-chrome>
      <mac-window-content>
        <ui-frame shallow white>
          <pre>
          </pre>
        </ui-frame>
      </mac-window-content>
    </mac-window>
    <style>
      app-simple-text {
        & textarea {
          width: 100%;
          height: 100%;
          border: none;
          color: var(--text);
          font-size: 11px;
          padding: 8px;
          resize: none;
          outline: none;
          overflow: auto;
          box-sizing: border-box;
        }
      }
    </style>
  </app-task-man>
</template>

<script>
  if (typeof TaskMan === 'undefined') {
    class TaskMan extends MacApplication {
      #timer;

      constructor() {
        super();
      }

      connectedCallback() {
        super.connectedCallback();
        this.#timer = setInterval(() => {
          this.querySelector('pre').textContent = `== Active ==
${MacApplication.activeApplication}

== Processes ==
${MacApplication.processes.map(p => p.name).join('\n')}`.trim();
        }, 1000);
      }

      disconnectedCallback() {
        clearInterval(this.#timer);
      }
      
      showAbout() {
        this.showDialog('TaskMan Task Manager');
      }

      get name() { return 'TaskMan' }
      get icon() { return 'apps/task-man/icon.svg' }

      newWindow = () => {}

      onAction = (source, action, detail) => {
        if (source === 'menu') {
          switch (action) {
            case 'close':
              this.exit();
              break;
            case 'about':
              this.showAbout();
              break;
          }
        }
      }
    }

    customElements.define('app-task-man', TaskMan);
  }
</script>